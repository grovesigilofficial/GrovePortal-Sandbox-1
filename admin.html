<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Admin Panel — GrovePortal-Sandbox-1</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<main class="container">
  <h1>Admin Panel — GrovePortal-Sandbox-1</h1>
  <h2>Uberman Sleep Day: <span id="counter-display">0</span></h2>
  <h3>Current Time: <span id="live-timer">00:00:00.000</span></h3>
  <h3 id="countdown">Next nap in: 04:00:00</h3>

  <div style="margin-top:24px;">
    <button id="start-btn">Start Uberman</button>
    <button id="reset-btn">Reset Uberman</button>
  </div>

  <p style="margin-top:24px;"><a href="index.html">Back Home</a></p>
</main>

<script>
// Uberman Counter
let startTime = localStorage.getItem('grove_start_time');
let running = localStorage.getItem('grove_running') === 'true';
const napInterval = 4 * 60 * 60 * 1000; // 4 hours

function saveStart(time) {
  localStorage.setItem('grove_start_time', time);
  localStorage.setItem('grove_running', 'true');
  startTime = time;
  running = true;
}

function startUberman() {
  if (!running) saveStart(Date.now());
  updateCounter();
}

function resetUberman() {
  localStorage.removeItem('grove_start_time');
  localStorage.setItem('grove_running', 'false');
  startTime = null;
  running = false;

  const display = document.getElementById('counter-display');
  const liveTimer = document.getElementById('live-timer');
  const countdown = document.getElementById('countdown');

  if (display) display.textContent = '0';
  if (liveTimer) liveTimer.textContent = '00:00:00.000';
  if (countdown) countdown.textContent = 'Next nap in: 04:00:00';
}

function formatTime(ms) {
  const totalSeconds = Math.floor(ms / 1000);
  const h = String(Math.floor(totalSeconds / 3600)).padStart(2,'0');
  const m = String(Math.floor((totalSeconds % 3600)/60)).padStart(2,'0');
  const s = String(totalSeconds % 60).padStart(2,'0');
  return `${h}:${m}:${s}`;
}

function updateCounter() {
  if (!startTime) return;
  const display = document.getElementById('counter-display');
  const liveTimer = document.getElementById('live-timer');
  const countdownEl = document.getElementById('countdown');
  if (!display || !liveTimer || !countdownEl) return;

  const now = Date.now();
  const elapsed = now - startTime;

  const day = Math.floor(elapsed / (1000 * 60 * 60 * 24));
  const time = new Date(elapsed).toISOString().substr(11, 12);

  display.textContent = day;
  liveTimer.textContent = time;

  const timeSinceLastNap = elapsed % napInterval;
  const nextNapIn = napInterval - timeSinceLastNap;
  countdownEl.textContent = 'Next nap in: ' + formatTime(nextNapIn);

  if (running) requestAnimationFrame(updateCounter);
}

// Buttons
document.addEventListener('DOMContentLoaded', () => {
  if (running) requestAnimationFrame(updateCounter);
  document.getElementById('start-btn').addEventListener('click', startUberman);
  document.getElementById('reset-btn').addEventListener('click', resetUberman);
});
</script>
</body>
</html>
